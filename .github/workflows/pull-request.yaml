on:
  pull_request:
    branches:
      - main
name: PullRequest
jobs:
  analyze:
    name: analyze
    runs-on: ubuntu-latest
    container: niklaslehnfeld/flutter-essentials:latest
    steps:
      - uses: actions/checkout@v2
      - run: flutter pub get
      - run: flutter pub run build_runner build --delete-conflicting-outputs
      - run: flutter analyze
  test:
    name: test
    runs-on: ubuntu-latest
    container: niklaslehnfeld/flutter-essentials:latest
    steps:
      - uses: actions/checkout@v2
      - run: flutter pub get
      - run: flutter pub run build_runner build --delete-conflicting-outputs
      - run: flutter test
  android-build:
    name: android-build
    runs-on: ubuntu-latest
    needs: [test, analyze]
    container: niklaslehnfeld/flutter-essentials:latest
    steps:
      - uses: actions/checkout@v2
      - name: Initiliaze Flutter
        run: flutter pub get
      - name: Generate Flutter Serialization Code
        run: flutter pub run build_runner build --delete-conflicting-outputs
      - name: Build APK
        run: cd android && ./gradlew assembleDebug
      - name: Archive APK
        uses: actions/upload-artifact@v2
        with:
          name: debug-build
          path: build/app/outputs/apk/debug/*.apk
#  ios-build:
#    name: Build iOS
#    runs-on: macos-latest
#    steps:
#      - uses: actions/checkout@v2
#      - name: Select Xcode version
#        run: sudo xcode-select -s '/Applications/Xcode_11.3.app/Contents/Developer'
#      - name: Setup JDK
#        uses: actions/setup-java@v1
#        with:
#          java-version: "12.x"
#      - name: Setup flutter
#        uses: subosito/flutter-action@v1
#        with:
#          flutter-version: "1.17.0"
#          channel: "stable"
#      - name: Install tools
#        run: |
#          flutter channel master && flutter pub get
#          flutter precache --ios
#          cd ./ios && pod install
#      - name: Build iOS Project
#        run: flutter build ios
